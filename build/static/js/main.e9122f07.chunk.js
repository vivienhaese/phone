(this.webpackJsonpaircall=this.webpackJsonpaircall||[]).push([[0],{450:function(e,t,n){},456:function(e,t,n){"use strict";n.r(t);var a,c,i,l,r,o=n(38),s=n(0),d=n.n(s),j=n(83),u=n.n(j),b=n(53),h=(n(450),n(184)),O=n(473),x=n(13),m=n(20),p=n(479),v=n(482),f=n(10),g=n(186),C=n(480),S=n(481),y=n(62),w=n(476),I=(Object(w.a)(a||(a=Object(y.a)(["\n  query Me {\n    me {\n      username\n    }\n  }\n"]))),Object(w.a)(c||(c=Object(y.a)(["\n  query Call($id: ID!) {\n    call(id: $id) {\n      id\n      direction\n      from\n      to\n      is_archived\n      created_at\n      call_type\n      notes {\n        id\n        content\n      }\n    }\n  }\n"])))),k=Object(w.a)(i||(i=Object(y.a)(["\n  query PaginatedCalls($offset: Float, $limit: Float) {\n    paginatedCalls(offset: $offset, limit: $limit) {\n      nodes {\n        id\n        direction\n        from\n        to\n        is_archived\n        created_at\n        call_type\n      }\n      totalCount\n      hasNextPage\n    }\n  }\n"]))),_=Object(w.a)(l||(l=Object(y.a)(["\n  mutation ArchiveCall($id: ID!) {\n    archiveCall(id: $id) {\n      id\n      is_archived\n    }\n  }\n"]))),F=Object(w.a)(r||(r=Object(y.a)(["\n  mutation Login($input: LoginInput!) {\n    login(input: $input) {\n      access_token\n      refresh_token\n      user {\n        id\n        username\n      }\n    }\n  }\n"]))),A=n(5);var z=function(){var e=Object(x.g)().callId,t=Object(p.a)(I,{variables:{id:e}}),n=t.loading,a=t.data,c=t.error,i=Object(v.a)(_,{onCompleted:function(e){var t=e.archiveCall;console.log("".concat(t," call archived"))}}),l=Object(m.a)(i,1)[0],r=null===a||void 0===a?void 0:a.call,o=Object(s.useCallback)((function(){l({variables:{id:r.id}})}),[l,r]);return c&&console.log(n,r,c),n||!r?Object(A.jsx)("h4",{children:"Loading call..."}):Object(A.jsxs)(f.Flex,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",children:[Object(A.jsx)(f.Icon,{component:"inbound"===r.direction?f.CallInboundFilled:f.CallOutboundFilled,color:"primary.base",size:60,marginBottom:"12px"}),Object(A.jsxs)(g.a,{variant:"heading",children:["From: ",r.from]}),Object(A.jsxs)(g.a,{variant:"heading",children:["To: ",r.to]}),Object(A.jsx)(g.a,{variant:"overline2",children:new Date(r.created_at).toLocaleString()}),Object(A.jsx)(C.a,{orientation:"horizontal",size:"small",marginY:"20px"}),Object(A.jsx)(g.a,{variant:"heading",marginBottom:"6px",children:"Notes"}),r.notes.length?r.notes.map((function(e){return Object(A.jsx)(g.a,{variant:"body",children:e.content},"call_".concat(r.id,"_note_").concat(e.id))})):Object(A.jsx)(g.a,{variant:"overline2",children:"Aucune note pour le moment"}),Object(A.jsx)(C.a,{orientation:"horizontal",size:"small",marginY:"20px"}),r.is_archived?Object(A.jsx)(g.a,{variant:"overline2",children:"Call archived"}):Object(A.jsx)(S.a,{variant:"warning",onClick:o,children:"Archive call"})]})},D=n(457),L=n(82),N=n(183);var $=function(e){var t=e.call,n="inbound"===t.direction;return Object(A.jsx)(f.Box,{boxShadow:1,borderRadius:8,height:"50px",width:"250px",paddingX:"12px",paddingY:"6px",cursor:"pointer",className:"call-item",opacity:t.is_archived?.35:1,children:Object(A.jsxs)(f.Flex,{flexDirection:"row",alignItems:"center",justifyContent:"flex-start",children:[Object(A.jsx)(f.Icon,{component:n?f.CallInboundFilled:f.CallOutboundFilled,color:"primary.base",marginRight:"12px",size:36}),Object(A.jsxs)(f.Flex,{flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",children:[Object(A.jsx)(g.a,{textAlign:"left",children:n?t.from:t.to}),Object(A.jsx)(g.a,{textAlign:"left",color:"secondary.base",fontSize:".85em",children:new Date(t.created_at).toLocaleTimeString()})]})]})})};var T=function(e){var t=e.calls,n=e.isSelectionActive,a=e.selectedCalls,c=e.onCallSelected,i=Object(x.h)().path,l=Object(N.a)(t).sort((function(e,t){return t.created_at.localeCompare(e.created_at)})).reduce((function(e,t){var n=t.created_at.split("T")[0];return e[n]||(e[n]=[]),e[n].push(t),e}),{}),r=Object.keys(l).sort((function(e,t){return t.localeCompare(e)}));return Object(A.jsx)(s.Fragment,{children:r.map((function(e){return Object(A.jsxs)(s.Fragment,{children:[Object(A.jsx)(g.a,{variant:"caption",marginBottom:"4px",children:new Date(e).toLocaleDateString()}),Object(A.jsx)(D.a,{direction:"vertical",space:"xs",children:l[e].map((function(e){return Object(A.jsxs)(D.a,{direction:"horizontal",space:"xs",alignItems:"center",children:[n?Object(A.jsx)(f.Checkbox,{checked:!!a[e.id],disabled:e.is_archived,id:"selectCallCheckbox_".concat(e.id),onChange:function(t){c(Object(o.a)(Object(o.a)({},a),{},Object(L.a)({},e.id,t)))}}):null,Object(A.jsx)(b.b,{to:"".concat(i,"/").concat(e.id),activeClassName:"selected",children:Object(A.jsx)($,{call:e})})]},"callListItem_".concat(e.id))}))})]},"datesListItem_".concat(e))}))})};var B=function(e){var t=e.callNumber;return Object(A.jsxs)(D.a,{direction:"vertical",space:"s",justifyContent:"flex-start",children:[Object(A.jsx)(f.Skeleton,{width:128,height:24}),Array.from(Array(t).keys()).map((function(e,t){return Object(A.jsx)(f.Skeleton,{width:250,height:50},"callListSkeleton_".concat(t))}))]})};var G,P=function(){var e,t,n=Object(x.h)().path,a=Object(s.useState)(0),c=Object(m.a)(a,2),i=c[0],l=c[1],r=Object(s.useState)(!1),o=Object(m.a)(r,2),d=o[0],j=o[1],u=Object(s.useState)({}),b=Object(m.a)(u,2),h=b[0],O=b[1],C=Object(p.a)(k,{variables:{offset:i,limit:10}}),y=C.loading,w=C.data,I=(null===w||void 0===w||null===(e=w.paginatedCalls)||void 0===e?void 0:e.nodes)||[],F=(null===w||void 0===w||null===(t=w.paginatedCalls)||void 0===t?void 0:t.hasNextPage)||!1,L=Object(s.useCallback)((function(){l(i+10)}),[i]),N=Object(s.useCallback)((function(){l(i-10)}),[i]),$=Object.keys(h).reduce((function(e,t){return e+(h[t]?1:0)}),0),G=Object(v.a)(_,{onCompleted:function(e){var t=e.archiveCall;console.log("".concat(t," call archived"))}}),P=Object(m.a)(G,1)[0],q=Object(s.useCallback)((function(){Object.keys(h).forEach((function(e){h[e]&&P({variables:{id:e}})})),O({}),j(!1)}),[P,h]);return Object(A.jsxs)(f.Grid,{gridTemplateColumns:"max-content auto",gridGap:3,children:[Object(A.jsx)(f.Flex,{bg:"base.white",alignItems:"center",justifyContent:"center",width:"300px",p:3,children:Object(A.jsxs)(D.a,{direction:"vertical",space:"s",justifyContent:"center",children:[Object(A.jsxs)(f.Flex,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[Object(A.jsx)(g.a,{variant:"displayM",children:"Calls"}),Object(A.jsx)(S.a,{size:"xSmall",onClick:function(){d&&O({}),j(!d)},children:d?"Cancel":"Select calls"})]}),Object(A.jsx)(f.Flex,{justifyContent:"center",children:d?$?Object(A.jsxs)(S.a,{variant:"warning",size:"xSmall",onClick:q,children:["Archive ",$+" ",1===$?"call":"calls"]}):Object(A.jsx)(g.a,{children:"Select at least one call to archive"}):null}),y?Object(A.jsx)(B,{callNumber:10}):Object(A.jsx)(T,{calls:I,isSelectionActive:d,selectedCalls:h,onCallSelected:function(e){return O(e)}}),Object(A.jsxs)(f.Flex,{flexDirection:"row",justifyContent:"space-between",children:[0!==i?Object(A.jsx)(S.a,{onClick:N,children:"Previous"}):Object(A.jsx)(f.Flex,{}),F?Object(A.jsx)(S.a,{onClick:L,children:"Next"}):Object(A.jsx)(f.Flex,{})]})]})}),Object(A.jsx)(f.Flex,{alignItems:"center",justifyContent:"center",p:3,children:Object(A.jsxs)(x.d,{children:[Object(A.jsx)(x.b,{exact:!0,path:n,children:Object(A.jsx)("h4",{children:"Select a call to view details."})}),Object(A.jsx)(x.b,{path:"".concat(n,"/:callId"),children:Object(A.jsx)(z,{})})]})})]})},q=n(478);!function(e){e.SignIn="SIGN_IN",e.SignOut="SIGN_OUT"}(G||(G={}));var R=function(e,t){switch(t.type){case G.SignIn:return Object.assign({},e,{authenticated:!0});case G.SignOut:return Object.assign({},e,{authenticated:!1});default:return e}},E={auth:{authenticated:!1}},M=Object(s.createContext)({state:E,dispatch:function(){return null}}),U=function(e,t){var n=e.auth;return{auth:R(n,t)}},Y=function(e){var t=e.children,n=Object(s.useReducer)(U,E),a=Object(m.a)(n,2),c=a[0],i=a[1];return Object(A.jsx)(M.Provider,{value:{state:c,dispatch:i},children:t})};var J=function(){var e=d.a.useContext(M),t=e.state,n=e.dispatch,a=Object(v.a)(F,{onCompleted:function(e){e.login;n({type:G.SignIn,payload:{}})}}),c=Object(m.a)(a,2),i=c[0],l=c[1].loading,r=Object(s.useState)(""),o=Object(m.a)(r,2),j=o[0],u=o[1],b=Object(s.useState)(""),h=Object(m.a)(b,2),O=h[0],p=h[1],g=Object(s.useCallback)((function(){i({variables:{input:{username:j,password:O}}})}),[O,j,i]);return t.auth.authenticated?Object(A.jsx)(x.a,{to:{pathname:X}}):Object(A.jsx)(f.Box,{width:"400px",mx:"auto",mt:"20vh",children:Object(A.jsx)(f.Form,{onSubmit:function(e){e.preventDefault()},children:Object(A.jsxs)(f.Grid,{gridColumnGap:4,gridRowGap:5,gridTemplateColumns:"1fr",children:[Object(A.jsx)(f.FormItem,{label:"Username",name:"username",children:Object(A.jsx)(q.a,{placeholder:"john.doe@example.com",value:j,onChange:function(e){return u(e.target.value)}})}),Object(A.jsx)(f.FormItem,{label:"Password",name:"password",children:Object(A.jsx)(q.a,{type:"password",value:O,onChange:function(e){return p(e.target.value)}})}),Object(A.jsx)(f.FormItem,{children:l?Object(A.jsxs)(S.a,{readOnly:!0,children:[Object(A.jsx)(f.Icon,{component:f.SpinnerOutlined,spin:!0})," Loading"]}):Object(A.jsx)(S.a,{disabled:!j.length||!O.length,onClick:g,children:"Log in"})})]})})})},H="/login",X="/calls",K=function(e){var t=e.component,n=e.isAuthenticated,a=Object(h.a)(e,["component","isAuthenticated"]);return Object(A.jsx)(x.b,Object(o.a)(Object(o.a)({},a),{},{render:function(e){return n?d.a.createElement(t,e):Object(A.jsx)(x.a,{to:{pathname:H}})}}))},Q=function(){var e=d.a.useContext(M).state;return Object(A.jsx)(O.a,{injectStyle:!0,children:Object(A.jsxs)(x.d,{children:[Object(A.jsx)(x.b,{exact:!0,path:H,component:J}),Object(A.jsx)(K,{path:X,isAuthenticated:e.auth.authenticated,component:P}),Object(A.jsx)(x.b,{render:function(){return Object(A.jsx)(x.a,{to:X})}})]})})},V=n(475),W=n(99),Z=n(474),ee=n(471),te=n(477),ne=n(472),ae=new V.a({uri:"https://frontend-test-api.aircall.io/graphql"}),ce=new W.a((function(e,t){return e.setContext((function(e){var t=e.headers,n=void 0===t?{}:t;return{headers:Object(o.a)(Object(o.a)({},n),{},{authorization:"Bearer "+localStorage.getItem("token")||!1})}})),t(e).map((function(t){var n;if((null===(n=t.errors)||void 0===n?void 0:n.length)&&"Unauthorized"===t.errors[0].message&&console.log("Handle unauthorized response, redirect to login"),"Login"===e.operationName){var a,c,i=null===(a=t.data)||void 0===a||null===(c=a.login)||void 0===c?void 0:c.access_token;console.log("Token received ".concat(i)),localStorage.setItem("token",i)}return t}))})),ie=new Z.a({link:Object(ee.a)(ce,ae),cache:new te.a,name:"vhAircallTest",version:"1.0"});u.a.render(Object(A.jsx)(d.a.StrictMode,{children:Object(A.jsx)(ne.a,{client:ie,children:Object(A.jsx)(Y,{children:Object(A.jsx)(b.a,{children:Object(A.jsx)(Q,{})})})})}),document.getElementById("root"))}},[[456,1,2]]]);
//# sourceMappingURL=main.e9122f07.chunk.js.map